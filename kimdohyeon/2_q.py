from bert_score import score
from itertools import combinations

# 🔹 RAG 기반 응답 (모델 이름 + 텍스트)
rag_responses = [
    ("gpt-4o", """갑상선암의 진단은 병리 또는 진단검사의학의 전문의 자격증을 가진 자에 의해 내려져야 합니다. 이 진단은 조직 검사(fixed tissue), 미세바늘흡인검사(fine needle aspiration), 또는 혈액 검사(hemic system)에 대한 현미경 소견을 기초로 하여야 합니다."""),

    ("gpt-3.5", """"갑상선암"의 진단은 조직검사(fixed tissue) 또는 미세바늘흡인검사(fine needle aspiration) 또는 혈액검사(hemic system)에 대한 현미경 소견을 기반으로 내려져야 합니다. 이러한 진단은 병리 또는 진단검사의학의 전문의 자에 의해 내려져야 합니다."""),

    ("claude-opus-4", """갑상선암의 진단확정은 병리 또는 진단검사의학 전문의에 의해 이루어져야 합니다. 이는 조직검사, 미세바늘흡인검사 또는 혈액검사에 대한 현미경 소견을 기초로 합니다. 진단확정 시점은 상기 검사에 의한 결과보고 시점으로 합니다."""),

    ("claude-opus-3", """갑상선암 진단확정은 병리 또는 진단검사의학의 전문의 자격증을 가진 자에 의해 내려져야 합니다. 진단은 조직(fixed tissue)검사, 미세바늘흡인검사(fine needle aspiration), 또는 혈액(hemic system)검사에 대한 현미경 소견을 기초로 해야 합니다. 진단확정 시점은 이러한 검사에 의한 결과보고 시점으로 합니다.""")
]

# 🔹 LLM 일반 응답 (모델 이름 + 텍스트)
responses = [
    ("gpt-4o", """갑상선암을 진단하기 위해 일반적으로 다음과 같은 검사가 사용됩니다:

1. **신체 검사**: 의사가 목 부위를 만져서 갑상선의 크기나 결절 여부를 확인합니다.
2. **혈액 검사**: 갑상선 기능을 평가하기 위해 갑상선 자극 호르몬(TSH)과 갑상선 호르몬(T3, T4) 수치를 측정합니다.
3. **초음파 검사**: 갑상선의 결절이나 이상을 확인하기 위해 초음파를 사용합니다.
4. **미세침 흡인 생검(FNA)**: 초음파를 이용해 갑상선 결절에서 세포를 채취하여 분석합니다.
5. **방사성 요오드 스캔**: 갑상선의 기능을 평가하고 결절의 성격을 파악합니다.
6. **CT 또는 MRI**: 암이 주변 조직으로 퍼졌는지 확인합니다.

갑상선암 진단을 위해서는 초음파 검사와 FNA가 가장 중요하며, 보험 청구를 위해서는 진단서와 검사 결과가 필요할 수 있습니다."""),

    ("gpt-3.5", """갑상선암을 진단받기 위해서는 다음과 같은 검사가 필요합니다:

1. 혈액검사: 갑상선 호르몬 수치와 갑상선 관련 마커인 TSH 수치를 확인합니다.
2. 초음파 검사: 갑상선 종양의 크기와 형태를 확인하기 위해 초음파 검사를 시행합니다.
3. 갑상선 바늘 생검: 갑상선 종양의 세포학적 특성을 확인하기 위해 생검을 시행합니다."""),

    ("claude-opus-4", """유사암진단비III 청구를 위한 갑상선암 진단 검사 안내:

1. **조직병리검사 (필수)**  
   - 세침흡인검사(FNA): 가장 기본적인 검사  
   - 중심부 바늘생검(CNB): 불충분한 경우 보완  
   - 수술 후 조직검사: 최종 확진

2. **영상검사**  
   - 갑상선 초음파, CT, MRI, PET-CT 등

보험금 청구시 필요서류:
- 진단서
- 조직병리검사 결과지
- 영상검사 결과지
- 수술확인서

보험 약관에 따라 보장 범위가 다르므로 확인이 필요합니다."""),

    ("claude-opus-3", """유사암진단비III를 청구하기 위해서는 갑상선암에 대한 명확한 진단이 필요합니다. 일반적으로 갑상선암 진단을 위해 다음과 같은 검사들이 시행됩니다:

1. 갑상선 초음파 검사: 갑상선의 크기, 모양, 결절 유무 등을 확인하는 영상 검사입니다.
2. 갑상선 호르몬 검사: 혈액 검사를 통해 갑상선 기능을 평가합니다. (T3, T4, TSH 등)
3. 갑상선 스캔: 방사성 요오드를 이용하여 갑상선의 기능과 결절의 특성을 평가하는 검사입니다.
4. 세침흡인검사 (Fine Needle Aspiration, FNA): 의심되는 결절에서 세포를 채취하여 현미경으로 관찰함으로써 암 여부를 판단하는 검사입니다. 가장 중요한 확진 검사 중 하나입니다.
5. 조직검사: 수술을 통해 의심되는 조직을 채취하여 병리학적으로 확진하는 검사입니다.

보험사마다 유사암진단비III 청구를 위한 구체적인 요건이 다를 수 있으므로, 가입한 보험사에 문의하여 필요한 검사 결과와 진단서 등을 확인하는 것이 좋습니다. 일반적으로는 세침흡인검사나 조직검사를 통한 병리학적 확진이 필요할 것으로 예상됩니다.""")
]

# 🔹 1. LLM 응답끼리 비교
print("🔸 LLM 응답 간 BERTScore 비교:")
for (i, (name1, sent1)), (j, (name2, sent2)) in combinations(enumerate(responses), 2):
    P, R, F1 = score([sent1], [sent2], lang="ko", verbose=False)
    print(f"{name1} vs {name2} → BERTScore F1: {F1[0]:.4f}")

# 🔹 2. RAG 응답끼리 비교
print("\n🔸 RAG 응답 간 BERTScore 비교:")
for (i, (name1, sent1)), (j, (name2, sent2)) in combinations(enumerate(rag_responses), 2):
    P, R, F1 = score([sent1], [sent2], lang="ko", verbose=False)
    print(f"{name1} vs {name2} → BERTScore F1: {F1[0]:.4f}")

# 🔹 3. RAG vs LLM 응답 비교
print("\n🔸 RAG vs LLM 응답 BERTScore 비교:")
for rag_name, rag_sent in rag_responses:
    for llm_name, llm_sent in responses:
        P, R, F1 = score([rag_sent], [llm_sent], lang="ko", verbose=False)
        print(f"{rag_name} vs {llm_name} → BERTScore F1: {F1[0]:.4f}")
